{"version":3,"sources":["../src/control.js"],"names":["define","$","Log","PubSub","EmergencyalertControl","region","self","prototype","main","drawBanner","body","subscribe","hasClass","window","scrollTo","on","block","closest","data","addClass","detach","prepend","height","navtop","css","navleft","page","init","instanceid","debug","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the block_emergency_alerts/control module\r\n *\r\n * @package   block_emergency_alerts\r\n * @category    output\r\n * @copyright 2019 Michael Vangelovski, Canberra Grammar School <michael.vangelovski@cgs.act.edu.au>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module block_emergency_alerts/control\r\n */\r\ndefine(['jquery', 'core/log', 'core/pubsub'], function($, Log, PubSub) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the block controls.\r\n     */\r\n    function init(instanceid) {\r\n        Log.debug('block_emergency_alerts/control: initializing instance ' + instanceid);\r\n\r\n        var region = $('[data-region=\"block_emergency_alerts-instance-' + instanceid +'\"]').first();\r\n\r\n        if (!region.length) {\r\n            Log.debug('block_emergency_alerts/control: wrapping region not found!');\r\n            return;\r\n        }\r\n\r\n        var control = new EmergencyalertControl(region);\r\n        control.main();\r\n    }\r\n\r\n    /**\r\n     * Controls a single my_day_timetable block instance contents.\r\n     *\r\n     * @constructor\r\n     * @param {jQuery} region\r\n     */\r\n    function EmergencyalertControl(region) {\r\n        var self = this;\r\n        self.region = region;\r\n    }\r\n\r\n    /**\r\n     * Run the controller.\r\n     *\r\n     */\r\n   EmergencyalertControl.prototype.main = function () {\r\n        var self = this;\r\n\r\n        self.drawBanner();\r\n\r\n        var body = $('body');\r\n        \r\n        //Subscribe to nav drawer event\r\n        PubSub.subscribe('nav-drawer-toggle-end', function(el){\r\n            if (body.hasClass('has-emergency-alert')) {\r\n                window.scrollTo(0, 0);\r\n            }\r\n        });\r\n\r\n        // Watch resize to adjust width\r\n        $(window).on('resize', function(){\r\n            self.drawBanner();\r\n        });\r\n    };\r\n\r\n    EmergencyalertControl.prototype.drawBanner = function () {\r\n        var self = this;\r\n\r\n        var body = $('body');\r\n        var block = self.region.closest('.block.block_emergency_alerts');\r\n\r\n        if ( ! body.hasClass('editing') && self.region.data('numalerts') ) {\r\n            block.addClass('active');\r\n            body.addClass('has-emergency-alert');\r\n            block.detach();\r\n            body.prepend(block);\r\n\r\n            var height = block.height();\r\n\r\n            var navtop = $('.navbar'); \r\n            var css = {\r\n                'margin-top' : height,\r\n                'position' : 'absolute',\r\n            };\r\n            navtop.css(css);\r\n\r\n            var navleft = $('#nav-drawer');\r\n            var css = {\r\n                'margin-top' : height,\r\n                'position' : 'absolute',\r\n                'height' : 'auto',\r\n                'overflow' : 'hidden',\r\n            };\r\n            navleft.css(css);\r\n            // Add scroll back into nav.\r\n            navleft.css('height', 'calc(100% - ' + (height + 70) + 'px)');\r\n            navleft.css('overflow-y', 'auto');\r\n\r\n            var page = $('#page');\r\n            page.css('margin-top', height+navtop.height());\r\n            body.css('overflow-y', 'auto');\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"control.min.js"}